resources:
  - name: cron_trigger
    type: CronTrigger
    configuration:
      interval: '*/5 * * * *'     # Every 5 minutes

  - name: go_repo
    type: GitRepo
    configuration:
      path: talarian1/frogbot
      branches:
        include: pipelines-yml
      gitProvider: tal_github

 
pipelines:
  - name: Frogbot
    steps:
      - name: build_go
        type: GoBuild
        configuration:
          inputResources:
            - name: cron_trigger
          sourceLocation: .
          noRegistry: true
          inputResources:
            - name: go_repo
      - name: Frogbot_Scan
        type: Bash
        configuration:
          integrations:
            - name: talJfrogPlatform
            - name: talBitbucket
          inputSteps:
            - name: build_go
          environmentVariables:
            # [Mandatory only for projects which use npm, pip, pipenv, nuget and dotnet to download their dependencies]
            # The command that installs the project dependencies (e.g "npm i", "nuget restore" or "dotnet restore")
            JF_INSTALL_DEPS_CMD: ""

            # [Mandatory]
            # JFrog platform URL
            JF_URL: int_talJfrogPlatform_url

            # [Mandatory if JF_USER and JF_PASSWORD are not provided]
            # JFrog access token with 'read' permissions for Xray
            JF_ACCESS_TOKEN: int_talJfrogPlatform_accessToken

            # [Mandatory]
            # Bitbucket accesses token with the following permissions 
            JF_GIT_TOKEN: int_talBitbucket_token
            JF_GIT_PROVIDER: "bitbucketServer"

            # [Mandatory]
            # API endpoint to Bitbucket server
            JF_GIT_API_ENDPOINT: int_talBitbucket_url

            # [Mandatory]
            # Bitbucket project namespace
            JF_GIT_OWNER: "~tala"

            # [Mandatory]
            # Bitbucket repository name
            JF_GIT_REPO: "yahavi"

            # Uncomment the below options if you'd like to use them.

            # [Mandatory if JF_ACCESS_TOKEN is not provided]
            # JFrog user and password with 'read' permissions for Xray
            #JF_USER: credentials("JF_USER")
            #JF_PASSWORD: credentials("JF_PASSWORD")

            # [Optional, default: "."]
            # Relative path to the project in the git repository
            # JF_WORKING_DIR: path/to/project/dir

            # [Optional]
            # Xray Watches. Learn more about them here: https://www.jfrog.com/confluence/display/JFROG/Configuring+Xray+Watches
            # JF_WATCHES: <watch-1>,<watch-2>...<watch-n>

            # [Optional]
            # JFrog project. Learn more about it here: https://www.jfrog.com/confluence/display/JFROG/Projects
            # JF_PROJECT: <project-key>
        execution:
          onExecute:
            - ./frogbot scan-pull-requests